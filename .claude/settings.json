{
  "permissions": {
    "allow": [
      // === Operazioni Git ===
      "Bash(git:*)",
      "Bash(gh:*)",

      // === Python & Dependency Management ===
      "Bash(pip:*)",
      "Bash(pip3:*)",
      "Bash(python:*)",
      "Bash(python3:*)",
      "Bash(poetry:*)",
      "Bash(source venv/bin/activate)",
      "Bash(source ../venv/bin/activate)",
      "Bash(python -c:*)",
      "Bash(python -m:*)",

      // === Database Operations ===
      "Bash(mysql:*)",
      "Bash(alembic:*)",

      // === File System Operations ===
      "Bash(chmod:*)",
      "Bash(chown:*)",
      "Bash(find:*)",
      "Bash(grep:*)",
      "Bash(tree:*)",
      "Bash(ls:*)",
      "Bash(cat:*)",
      "Bash(mkdir:*)",
      "Bash(cp:*)",
      "Bash(mv:*)",
      "Bash(wc:*)",
      "Bash(head:*)",
      "Bash(tail:*)",
      "Bash(touch:*)",
      "Bash(echo:*)",
      "Bash(sed:*)",
      "Bash(awk:*)",

      // === Navigation ===
      "Bash(cd:*)",
      "Bash(pwd)",

      // === Testing ===
      "Bash(pytest:*)",
      "Bash(pytest-cov:*)",

      // === Development Servers ===
      "Bash(uvicorn:*)",
      "Bash(fastapi:*)",

      // === Code Quality ===
      "Bash(black:*)",
      "Bash(flake8:*)",
      "Bash(mypy:*)",

      // === Process Management ===
      "Bash(ps:*)",
      "Bash(kill:*)",
      "Bash(pkill:*)",

      // === System Info ===
      "Bash(df:*)",
      "Bash(du:*)",
      "Bash(free:*)",

      // === File Operations - Auto-approve ===
      "Write(*)",
      "Edit(*)",
      "Read(*)",
      "Glob(*)",
      "Grep(*)",
      "NotebookEdit(*)",

      // === Git Operations ===
      "Bash(git add:*)",
      "Bash(git commit:*)",

      // === Web ===
      "WebSearch"
    ],
    "deny": [
      // Operazioni pericolose - Sempre negate
      "Bash(rm -rf /)",
      "Bash(dd:*)",
      "Bash(mkfs:*)",
      "Bash(fdisk:*)",
      "Bash(format:*)",
      "Bash(sudo rm:*)"
    ],
    "ask": [
      // Operazioni che richiedono conferma
      "Bash(rm *)",
      "Bash(rm -r*)",
      "Bash(rm -f*)",
      "Bash(DROP DATABASE:*)",
      "Bash(truncate:*)",
      "Bash(git reset --hard:*)",
      "Bash(git push --force:*)"
    ]
  },

  "project": {
    "name": "My Personal Map",
    "version": "1.0.0-MVP",
    "description": "Applicazione Python per gestione mappe personali con segnaposti geografici",
    "root": "/media/federicocalo/D/prj/myPersonalMap",
    "modules": {
      "backend": "pymypersonalmap",
      "docs": "doc"
    },
    "tech_stack": {
      "backend": "FastAPI + SQLAlchemy + MySQL",
      "geospatial": "GeoPandas + Shapely + Folium + GeoPy",
      "gui": "CustomTkinter",
      "testing": "pytest",
      "database": "MySQL 8.0+ with spatial types"
    }
  },

  "agents": {
    "default": "backend-dev",
    "available": [
      {
        "name": "backend-dev",
        "description": "FastAPI backend development specialist",
        "file": "agents/backend-dev.md"
      },
      {
        "name": "database-expert",
        "description": "MySQL spatial database and SQLAlchemy expert",
        "file": "agents/database-expert.md"
      },
      {
        "name": "documentation-writer",
        "description": "Technical documentation specialist",
        "file": "agents/documentation-writer.md"
      },
      {
        "name": "test-engineer",
        "description": "pytest testing specialist",
        "file": "agents/test-engineer.md"
      }
    ]
  },

  "environment": {
    "PYTHONPATH": "${PROJECT_ROOT}/pymypersonalmap",
    "VIRTUAL_ENV": "${PROJECT_ROOT}/venv",
    "DATABASE_URL": "mysql+pymysql://mypersonalmap_user:password@localhost:3306/mypersonalmap"
  },

  "context": {
    "description": "Configurazione contesto file per Claude Code - My Personal Map",
    "ignore_file": ".claudeignore",
    "priority_files": [
      // === Documentazione Principale (Max Priority) ===
      "CLAUDE.md",
      "README.md",

      // === Claude Configuration ===
      ".claude/**/*",

      // === Documentazione Tecnica ===
      "doc/architecture.md",
      "doc/database-design.md",
      "doc/api-documentation.md",
      "doc/tech-stack.md",
      "doc/mapping-services-comparison.md",

      // === Configurazione Progetto ===
      ".env.example",
      "pymypersonalmap/requirements.txt",
      "pymypersonalmap/config/settings.py",
      "alembic.ini",

      // === Entry Points ===
      "pymypersonalmap/main.py",
      "pymypersonalmap/database/session.py"
    ],
    "source_patterns": [
      // === Backend Source ===
      "pymypersonalmap/**/*.py",
      "pymypersonalmap/api/routes/*.py",
      "pymypersonalmap/services/*.py",
      "pymypersonalmap/models/*.py",
      "pymypersonalmap/database/*.py",
      "pymypersonalmap/config/*.py",

      // === Tests ===
      "pymypersonalmap/tests/**/*.py",

      // === Migrations ===
      "alembic/versions/*.py"
    ],
    "conditional_access": [
      {
        "pattern": ".git/**/*",
        "condition": "only_on_error",
        "description": "Accedi a .git solo per debugging errori Git"
      },
      {
        "pattern": "venv/**/*",
        "condition": "only_on_error",
        "description": "Accedi a venv solo per problemi dipendenze"
      },
      {
        "pattern": "__pycache__/**/*",
        "condition": "never",
        "description": "Ignora sempre cache Python"
      },
      {
        "pattern": "**/*.log",
        "condition": "only_on_error",
        "description": "Consulta log solo per troubleshooting"
      },
      {
        "pattern": "htmlcov/**/*",
        "condition": "only_on_coverage_analysis",
        "description": "Accedi a coverage report solo per analisi copertura"
      }
    ],
    "max_file_size": "1MB",
    "encoding": "UTF-8",
    "notes": [
      "La documentazione in doc/ ha priorità massima",
      "I file di configurazione sono sempre accessibili",
      "venv, __pycache__, .git sono esclusi di default",
      "Usa .claudeignore per esclusioni personalizzate",
      "Priority a file con logica geospaziale (coordinate, spatial queries)"
    ]
  },

  "commit": {
    "format": "[type] messaggio conciso",
    "types": {
      "feat": "Nuova funzionalità (endpoint, service, model)",
      "fix": "Bug fix",
      "docs": "Solo documentazione",
      "test": "Aggiunta o modifica test",
      "refactor": "Refactoring senza cambio funzionalità",
      "db": "Database migrations o schema changes",
      "config": "Modifiche configurazione",
      "deps": "Aggiornamento dipendenze"
    },
    "examples": [
      "[feat] aggiungi endpoint POST /api/v1/markers",
      "[feat] implementa MarkerService con geocoding",
      "[db] crea migration per markers table con spatial index",
      "[fix] correggi validazione coordinate latitude/longitude",
      "[test] aggiungi test per operazioni spatial queries",
      "[docs] documenta endpoint markers con esempi",
      "[refactor] estrai logica geocoding in service separato",
      "[config] aggiungi variabili ambiente per Nominatim"
    ],
    "rules": [
      "Usa prefisso appropriato tra i types definiti",
      "Messaggio conciso ma descrittivo (max 72 caratteri)",
      "Usa imperativo presente: 'aggiungi', 'implementa', 'fix'",
      "Non usare punto finale",
      "Per spatial data sempre menzionare SRID 4326 se rilevante",
      "Per API specificare path endpoint se applicabile"
    ]
  },

  "development": {
    "testing": {
      "command": "pytest",
      "coverage_command": "pytest --cov=pymypersonalmap --cov-report=term-missing",
      "test_db": "mypersonalmap_test",
      "coverage_threshold": 80
    },
    "formatting": {
      "tool": "black",
      "line_length": 88,
      "command": "black pymypersonalmap/"
    },
    "linting": {
      "tool": "flake8",
      "command": "flake8 pymypersonalmap/"
    },
    "type_checking": {
      "tool": "mypy",
      "command": "mypy pymypersonalmap/"
    },
    "server": {
      "dev_command": "uvicorn main:app --reload --host 0.0.0.0 --port 8000",
      "prod_command": "uvicorn main:app --host 0.0.0.0 --port 8000 --workers 4"
    }
  },

  "patterns": {
    "architecture": "Layered: Presentation → API → Service → Repository → Database",
    "api_versioning": "/api/v1/",
    "coordinate_system": "SRID 4326 (WGS84) for all spatial data",
    "geocoding_provider": "Nominatim (OpenStreetMap) - 1 req/sec rate limit",
    "error_handling": "HTTP status codes + structured JSON error responses",
    "authentication": "JWT tokens with refresh tokens",
    "database_migrations": "Alembic for all schema changes"
  },

  "important_constraints": [
    "SEMPRE usare SRID 4326 per dati spatial (GPS coordinates)",
    "SEMPRE validare coordinate: lat [-90, 90], lon [-180, 180]",
    "SEMPRE rispettare rate limit geocoding: 1 req/sec per Nominatim",
    "SEMPRE usare spatial indexes su colonne POINT/LINESTRING",
    "SEMPRE usare ST_Distance_Sphere per calcoli distanza accurate",
    "SEMPRE usare dependency injection per database session",
    "SEMPRE scrivere docstring Google style per funzioni pubbliche",
    "SEMPRE creare migration Alembic per modifiche schema",
    "SEMPRE scrivere test per nuove features (>80% coverage)"
  ]
}
